# Workflow Pilot - Progress Report
**Date:** 2026-01-11
**Session:** Configuration System & Mode Implementation

---

## Session Accomplishments

### Configuration System (New)
- [x] Created `src/config/schema.ts` - TypeScript interfaces for config
- [x] Created `src/config/loader.ts` - Config file loading with:
  - Multiple config file locations (env, project, user, default)
  - Environment variable overrides (`WORKFLOW_PILOT_MODE`)
  - Deep merge for partial config overrides
  - Validation and caching

### Three Operating Modes
- [x] **Minimal Mode** - Safety only (critical alerts), no context injection
- [x] **Training Mode** - Learning assistant with intent capture, explanations
- [x] **Guidance Mode** - "Claude guiding Claude" (default)

### Cooldown System (New)
- [x] Created `src/state/cooldown.ts` - Time-based throttling
- [x] Per-rule cooldown tracking
- [x] State persistence to `/tmp/workflow-pilot-state.json`
- [x] Configurable cooldown durations

### Smarter Info Triggers
- [x] Replaced message-count triggers with context-aware heuristics:
  - Test practice tip: After 3+ code edits without test
  - Commit practice tip: After 5+ file operations uncommitted
  - Plan mode tip: For complex prompts early in session
  - Step back tip: After multiple failures detected
- [x] Added new `info-step-back` rule for stuck situations

### Rule Improvements
- [x] Reduced false positives in `commit-before-switch` rule
- [x] Made `refactor-after-feature` more context-aware
- [x] All rules now include `ruleId` for cooldown tracking

### Version Bump
- Updated to version 0.3.0

---

## Files Created/Modified

### New Files
```
src/config/schema.ts      - Config type definitions and defaults
src/config/loader.ts      - Config loading and validation
src/state/cooldown.ts     - Cooldown state management
```

### Modified Files
```
src/index.ts              - Mode integration, config usage, filtering
src/rules/index.ts        - Smarter triggers, ruleId export
config/default.json       - New schema with modes and frequency
src/rules/index.test.ts   - Updated test for new rule behavior
```

---

## Configuration Schema

```typescript
interface WorkflowPilotConfig {
  mode: 'minimal' | 'training' | 'guidance';

  tiers: {
    critical: { enabled: boolean };
    warning: { enabled: boolean };
    info: { enabled: boolean };
  };

  categories: {
    testing: boolean;
    git: boolean;
    security: boolean;
    claudeCode: boolean;
    refactoring: boolean;
  };

  frequency: {
    defaultCooldownMinutes: number;
    infoCooldownMinutes: number;
    perRuleCooldowns?: Record<string, number>;
  };

  ai: { enabled: boolean; model: string; };
  training: { askIntent: boolean; explainSuggestions: boolean; };
  hooks: { userPromptSubmit: boolean; preToolUse: boolean; postToolUse: boolean; };
}
```

---

## Mode Behaviors

| Feature | Minimal | Training | Guidance |
|---------|---------|----------|----------|
| Critical alerts | Yes | Yes | Yes |
| Warning suggestions | No | Yes | Yes |
| Info tips | No | Yes (frequent) | Yes (rare) |
| Intent capture | No | Yes | No |
| Context injection | No | Yes | Yes |
| AI analyzer | No | Yes | Yes |

---

## Testing Status
- All 11 tests passing
- Build succeeds without errors

---

## PreToolUse Blocking Status
- Hook configured in `hooks.json`
- Logic implemented for dangerous command detection
- **Note:** Requires fresh Claude Code session to activate
- Detection patterns working: force push, hard reset, rm -rf, .env staging

---

## Next Steps

### Immediate
1. Test in fresh terminal to verify PreToolUse blocking
2. Test mode switching with different config files

### Future Vision
- PRD/spec parser for autonomous guidance
- Integration with GitHub issues/PRs
- Project-specific rule customization
- Multi-session state for progress tracking

---

## Quick Reference

### Switch Modes via Environment
```bash
# Minimal mode (safety only)
export WORKFLOW_PILOT_MODE=minimal

# Training mode (learning assistant)
export WORKFLOW_PILOT_MODE=training

# Guidance mode (default - Claude guiding Claude)
export WORKFLOW_PILOT_MODE=guidance
```

### Config File Locations (priority order)
1. `$WORKFLOW_PILOT_CONFIG` environment variable
2. `./config/workflow-pilot.json` (project-specific)
3. `~/.config/workflow-pilot/config.json` (user global)
4. Built-in default

### Debug Mode
```bash
export WORKFLOW_PILOT_DEBUG=1
```
